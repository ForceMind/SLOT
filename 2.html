<!DOCTYPE html>
<html lang="zh-CN">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1" />
<title>3x3 SLOT H5 Demo</title>
<style>
  /* =================== é«˜é¥±å’Œä¸»é¢˜ + ç´§å‡‘å¸ƒå±€ =================== */
  :root{
    --bg1:#0a0014; --bg2:#18002b; --bg3:#2b0040;
    --border:#4e1b9a; --muted:#cbb6ff; --text:#fff7ff;
    --btn1:#3a0ca3; --btn2:#7209b7; --btn3:#f72585;
    --cell1:#32104d; --cell2:#3f0f6b; --cellBorder:#7b2cbf;
    --win:#29f19c; --warn:#ffd166;
  }
  *{box-sizing:border-box}
  html,body{height:100%;margin:0;font-family:system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial;color:var(--text);
    background:linear-gradient(135deg,var(--bg1),var(--bg2) 40%, var(--bg3));}
  .app{max-width:900px;margin:0 auto;padding:12px}
  header{display:flex;align-items:center;justify-content:space-between;margin-bottom:8px}
  .brand{font-weight:900;letter-spacing:.6px;font-size:18px}
  .chip{display:flex;align-items:center;gap:8px;padding:6px 8px;border:1px solid var(--border);border-radius:12px;background:linear-gradient(145deg,#2a0b4b,#140628)}
  .chip .add{width:24px;height:24px;display:inline-flex;align-items:center;justify-content:center;border-radius:6px;background:linear-gradient(180deg,#ff2fd0,#c112a1);border:1px solid #ff8be6;cursor:pointer;font-weight:900}

  .board-wrap{border:1px solid var(--border);border-radius:12px;padding:10px;background:linear-gradient(180deg,rgba(255,255,255,.05),transparent)}

  /* è½¬è½´ */
  .reels{display:grid;grid-template-columns:repeat(3,1fr);gap:6px;background:linear-gradient(160deg,var(--cell1),var(--cell2));padding:8px;border-radius:10px;border:1px solid var(--cellBorder)}
  .col{display:grid;grid-template-rows:repeat(3,1fr);gap:6px}
  .cell{aspect-ratio:1/1;display:flex;align-items:center;justify-content:center;font-size:36px;border-radius:10px;border:1px solid #a064ff;background:radial-gradient(circle at 30% 25%, #5a1fb5, #2b0b5e 60%);box-shadow:inset 0 0 12px rgba(0,0,0,.45),0 2px 8px rgba(0,0,0,.45)}
  .cell.spinning{animation:pulse .25s linear infinite alternate;filter:saturate(.95) brightness(.97)}
  @keyframes pulse{to{transform:translateY(-1px)}}

  /* æ§åˆ¶åŒºï¼šæ¡Œé¢ä¸‰åˆ—ï¼›ç§»åŠ¨ç«¯ä¸¤åˆ—ï¼Œç¬¬ä¸‰å—ç‹¬å ä¸€è¡Œ */
  .controls{display:grid;grid-template-columns:repeat(2,1fr) 1.2fr;gap:6px;margin-top:8px}
  .group{display:flex;align-items:center;gap:6px;padding:6px;border:1px solid var(--border);border-radius:10px;background:linear-gradient(180deg,rgba(255,255,255,.06),rgba(255,255,255,.02));min-height:44px}
  .group label{color:var(--muted);font-size:12px;white-space:nowrap}
  .input{display:flex;align-items:center;gap:6px;margin-left:auto}
  .btn{appearance:none;border:1px solid #a84ae4;background:linear-gradient(180deg,var(--btn2),var(--btn3));color:#fff;padding:6px 10px;border-radius:8px;cursor:pointer;font-weight:700;min-width:38px}
  .btn.secondary{background:linear-gradient(180deg,var(--btn1),var(--btn2))}
  .btn.ghost{background:transparent;border-style:dashed}
  .grow{flex:1}
  .status{margin-top:8px;min-height:24px;font-size:14px}
  .status .ok{color:var(--win)}
  .status .warn{color:var(--warn)}

  /* ===== æ”¯ä»˜è¡¨æ ·å¼ ===== */
  .status{margin-top:12px; min-height:28px; font-size:14px}
  .status .ok{color:var(--win)}
  .status .bad{color:var(--lose)}
  .status .warn{color:var(--warn)}
  .paytable{margin-top:10px; font-size:13px; border-top:1px dashed #8b3df0; padding-top:10px; color:var(--muted)}
  .pt-grid{display:grid; grid-template-columns:repeat(5, minmax(0,1fr)); gap:6px;}
  .pt-item{background:rgba(255,255,255,.06); border:1px solid var(--border); padding:6px; border-radius:10px; text-align:center}

  /* è®¾ç½®å¼¹çª— */
  .modal-mask{position:fixed;inset:0;background:rgba(0,0,0,.5);display:none;align-items:center;justify-content:center;z-index:10}
  .modal{width:min(560px,92vw);border:1px solid var(--border);border-radius:12px;padding:12px;background:linear-gradient(180deg,#2a0b4b,#15062a)}
  .row{display:flex;align-items:center;gap:8px;margin:8px 0;flex-wrap:wrap}
  .row .spacer{flex:1}
  .field{display:flex;align-items:center;gap:6px}
  .field input[type=number]{width:110px;padding:6px 8px;border-radius:8px;border:1px solid #a84ae4;background:#11061f;color:#fff}
  .muted{color:var(--muted);font-size:12px}

  /* ç§»åŠ¨ç«¯ï¼šä¸¤åˆ— + ç¬¬äºŒè¡Œç‹¬å  */
  @media (max-width:640px){
    .controls{grid-template-columns:repeat(2,1fr);grid-auto-rows:1fr}
    .controls .group:nth-child(1),.controls .group:nth-child(2){grid-column:auto}
    .controls .group:nth-child(3){grid-column:1/-1}
    .cell{font-size:32px}
  }
</style>
</head>
<body>
<div class="app">
  <header>
    <div class="brand">ğŸ° 3Ã—3 SLOT</div>
    <div class="chip">ä½™é¢ï¼š<strong id="balance">1000</strong><span class="add" id="balanceAdd">+</span></div>
  </header>

  <section class="board-wrap">
    <!-- è½¬è½´ï¼š3Ã—3 -->
    <div class="reels" id="reels">
      <div class="col">
        <div class="cell" id="c00"></div><div class="cell" id="c01"></div><div class="cell" id="c02"></div>
      </div>
      <div class="col">
        <div class="cell" id="c10"></div><div class="cell" id="c11"></div><div class="cell" id="c12"></div>
      </div>
      <div class="col">
        <div class="cell" id="c20"></div><div class="cell" id="c21"></div><div class="cell" id="c22"></div>
      </div>
    </div>

    <!-- æ§åˆ¶å™¨ï¼šä¸‹æ³¨/çº¿æ•° åŒä¸€è¡Œï¼›æ“ä½œç‹¬å ä¸€è¡Œ -->
    <div class="controls">
      <div class="group">
        <label>ä¸‹æ³¨ (æ¯çº¿)</label>
        <div class="input"><button class="btn secondary" id="betMinus">-</button><strong id="bet">5</strong><button class="btn secondary" id="betPlus">+</button></div>
      </div>
      <div class="group">
        <label>çº¿æ•°</label>
        <div class="input"><button class="btn secondary" id="linesMinus">-</button><strong id="lines">5</strong><button class="btn secondary" id="linesPlus">+</button></div>
      </div>
      <div class="group">
        <button class="btn grow" id="spinBtn">SPIN</button>
        <button class="btn" id="autoBtn">AUTO Ã— 25</button>
        <button class="btn ghost" id="settingsBtn">è®¾ç½®</button>
      </div>
    </div>

    <div class="status" id="status"></div>

      <div class="paytable">
        <div>ğŸ¯ æ”¯ä»˜çº¿ï¼ˆæœ€å¤š5æ¡ï¼‰ï¼šæ¨ªæ’3æ¡ + ä¸¤æ¡å¯¹è§’çº¿ã€‚3ä¸ªç›¸åŒå›¾æ ‡è¿çº¿å³ä¸­å¥–ï¼ˆä»…æŒ‰ä»å·¦åˆ°å³ç»“ç®—ï¼‰ã€‚</div>
        <div class="pt-grid" id="ptGrid"></div>
      </div>

      <div class="footer muted">æç¤ºï¼šçº¿æ•°ä¸èƒ½è¶…è¿‡è®¾ç½®ä¸­çš„â€œå¯ç”¨ä¸­å¥–çº¿æ•°â€ã€‚</div>

    <div class="status" id="status"></div>
  </section>
</div>

<!-- è®¾ç½®å¼¹çª—ï¼ˆå«è¿”å¥–ç‡ä¸ä¸­å¥–ç‡æ¨¡æ‹Ÿï¼‰ -->
<div class="modal-mask" id="modalMask">
  <div class="modal">
    <div class="row"><h3>âš™ï¸ è®¾ç½®</h3><div class="spacer"></div><button class="btn ghost" id="closeModal">å…³é—­</button></div>
    <div class="row">
      <label>å¯ç”¨ä¸­å¥–çº¿æ•°ï¼ˆ1â€“5ï¼‰</label>
      <div class="field"><button class="btn secondary" id="maxLinesMinus">-</button><strong id="maxLinesLabel">5</strong><button class="btn secondary" id="maxLinesPlus">+</button></div>
    </div>
    <div class="muted">ä¸‹æ³¨â€œçº¿æ•°â€ä¸å¾—è¶…è¿‡æ­¤å¤„è®¾ç½®çš„å¯ç”¨ä¸­å¥–çº¿æ•°ã€‚</div>
    <hr style="border:none;border-top:1px dashed #8b3df0;margin:10px 0"/>
    <h3>ğŸ§ª æ¨¡æ‹Ÿä¸‹æ³¨ï¼ˆè¿”å¥–ç‡ & ä¸­å¥–ç‡ï¼‰</h3>
    <div class="row">
      <label>æ¯çº¿ä¸‹æ³¨</label><div class="field"><input id="simBet" type="number" value="5" min="1" max="100"/></div>
      <label>çº¿æ•°</label><div class="field"><input id="simLines" type="number" value="5" min="1" max="5"/></div>
      <label>æ¬¡æ•°</label><div class="field"><input id="simRounds" type="number" value="1000" min="1" max="100000"/></div>
      <button class="btn" id="runSim">å¼€å§‹æ¨¡æ‹Ÿ</button>
    </div>
    <div class="muted">è¿”å¥–ç‡ï¼ˆRTPï¼‰= æ€»è·å¾— / æ€»ä¸‹æ³¨ Ã— 100%ï¼›ä¸­å¥–ç‡ = ä¸­å¥–å±€æ•° / æ€»å±€æ•° Ã— 100%ã€‚</div>
    <div id="simResult" class="muted" style="margin-top:6px"></div>
  </div>
</div>

<script>
(function(){
  /* ============ ç¬¦å·/èµ”ç‡ä¸çº¿è·¯ ============ */
  // ç¬¦å·è¡¨ï¼ˆ3è¿åŒå›¾çš„å€æ•°ï¼‰ï¼Œweight ä¸ºå‡ºç°æƒé‡
  const SYMBOLS = [
    { id:'CHERRY', icon:'ğŸ’', weight:28, pay:10 },
    { id:'BELL',   icon:'ğŸ””', weight:24, pay:15 },
    { id:'STAR',   icon:'â­', weight:20, pay:20 },
    { id:'DIAM',   icon:'ğŸ’', weight:16, pay:30 },
    { id:'SEVEN',  icon:'7ï¸âƒ£', weight:12, pay:50 },
  ];
  // 5æ¡çº¿ï¼š3æ¨ª + 2æ–œï¼ˆå·¦â†’å³ï¼‰
  const LINES = [
    [[0,0],[1,0],[2,0]], [[0,1],[1,1],[2,1]], [[0,2],[1,2],[2,2]],
    [[0,0],[1,1],[2,2]], [[0,2],[1,1],[2,0]],
  ];

  /* ============ çŠ¶æ€ä¸DOM ============ */
  const state = { balance:1000, betPerLine:5, lines:5, maxLines:5, spinning:false, autoLeft:0, autoTimer:null };
  const $ = s=>document.querySelector(s);
  const balanceEl=$('#balance'), betEl=$('#bet'), linesEl=$('#lines'), statusEl=$('#status');
  const spinBtn=$('#spinBtn'), autoBtn=$('#autoBtn'), settingsBtn=$('#settingsBtn'), balanceAdd=$('#balanceAdd');
  const betMinus=$('#betMinus'), betPlus=$('#betPlus'), linesMinus=$('#linesMinus'), linesPlus=$('#linesPlus');
  const modalMask=$('#modalMask'), closeModal=$('#closeModal');
  const maxLinesMinus=$('#maxLinesMinus'), maxLinesPlus=$('#maxLinesPlus'), maxLinesLabel=$('#maxLinesLabel');
  const simBet=$('#simBet'), simLines=$('#simLines'), simRounds=$('#simRounds'), runSim=$('#runSim'), simResult=$('#simResult');

  /* ============ å·¥å…·å‡½æ•° ============ */
  function updateHUD(){
    balanceEl.textContent = state.balance.toFixed(0);
    betEl.textContent = state.betPerLine.toFixed(0);
    linesEl.textContent = state.lines;
    autoBtn.textContent = state.autoLeft>0 ? `åœæ­¢è‡ªåŠ¨ï¼ˆå‰© ${state.autoLeft}ï¼‰` : 'AUTO Ã— 25';
    maxLinesLabel.textContent = state.maxLines;
  }
  function setStatus(msg,cls=''){ statusEl.className='status'; if(cls) statusEl.classList.add(cls); statusEl.textContent=msg; }
  function totalBet(){ return state.betPerLine*state.lines; }
  function canSpin(){ if(state.lines>state.maxLines) return false; const tb=totalBet(); return !state.spinning && tb>0 && state.balance>=tb; }

  // åŠ æƒéšæœºå–ç¬¦å·
  function pickSymbol(){ const tw=SYMBOLS.reduce((a,s)=>a+s.weight,0); let t=Math.random()*tw; for(const s of SYMBOLS){ if((t-=s.weight)<=0) return s; } return SYMBOLS[0]; }
  // ç”Ÿæˆ 3Ã—3 ç»“æœ grid[col][row]
  function spinOnce(){ return Array.from({length:3},()=>Array.from({length:3},()=>pickSymbol())); }
  // è¯„ä¼°ä¸­å¥–
  function evaluate(grid, betPerLine, lines){
    const active = LINES.slice(0, lines); let win=0, hits=[];
    for(let i=0;i<active.length;i++){
      const c=active[i], a=grid[c[0][0]][c[0][1]], b=grid[c[1][0]][c[1][1]], d=grid[c[2][0]][c[2][1]];
      if(a.id===b.id && b.id===d.id){ win += betPerLine * a.pay; hits.push(i); }
    }
    return {win, hit: hits.length>0}; // hit è¡¨ç¤ºæ­¤å±€æ˜¯å¦ä¸­å¥–ï¼ˆè‡³å°‘å‘½ä¸­ä¸€æ¡çº¿ï¼‰
  }
  // æ¸²æŸ“åˆ°UI
  function renderGrid(grid){ for(let x=0;x<3;x++) for(let y=0;y<3;y++){ document.getElementById(`c${x}${y}`).textContent = grid[x][y].icon; } }

  /* ============ æ—‹è½¬æµç¨‹ ============ */
  async function doSpin(){
    if(!canSpin()){
      if(state.spinning) return;
      if(state.lines>state.maxLines){ setStatus(`çº¿æ•°(${state.lines}) è¶…å‡ºä¸Šé™(${state.maxLines})ï¼Œè¯·åœ¨è®¾ç½®ä¸­è°ƒæ•´ã€‚`,'warn'); return; }
      const need=totalBet()-state.balance; setStatus(need>0?`ä½™é¢ä¸è¶³ï¼Œå·® ${need.toFixed(0)}ã€‚`:'æ— æ•ˆçš„ä¸‹æ³¨ã€‚','warn'); return;
    }
    state.spinning=true; toggleControls(false);
    const stake=totalBet(); state.balance-=stake; updateHUD(); setStatus(`ä¸‹æ³¨ ${stake}ï¼Œæ—‹è½¬ä¸­â€¦`);

    // è§†è§‰æ»šåŠ¨
    const timers=[]; [0,1,2].forEach(cx=>{ const cells=[0,1,2].map(r=>document.getElementById(`c${cx}${r}`));
      cells.forEach(el=>el.classList.add('spinning')); timers[cx]=setInterval(()=>cells.forEach(el=>el.textContent=pickSymbol().icon),55); });

    const grid=spinOnce();
    for(let col=0;col<3;col++){ await new Promise(r=>setTimeout(r,300+col*220)); clearInterval(timers[col]);
      [0,1,2].forEach(rw=>{ const el=document.getElementById(`c${col}${rw}`); el.textContent=grid[col][rw].icon; el.classList.remove('spinning'); }); }

    const {win,hit}=evaluate(grid, state.betPerLine, state.lines);
    if(win>0){ state.balance+=win; setStatus(`ğŸ‰ ä¸­å¥– ${win}ï¼`,'ok'); }
    else setStatus('æœªä¸­å¥–ï¼Œå†è¯•ä¸€æ¬¡ï¼');
    updateHUD(); state.spinning=false; toggleControls(true);

    if(state.autoLeft>0){ state.autoLeft--; updateHUD(); if(state.autoLeft>0){ state.autoTimer=setTimeout(doSpin,420);} }
  }

  /* ============ äº¤äº’ ============ */
  function toggleControls(on){ spinBtn.disabled=!on; settingsBtn.disabled=!on; betMinus.disabled=betPlus.disabled=linesMinus.disabled=linesPlus.disabled=!on; }
  spinBtn.addEventListener('click', doSpin);
  autoBtn.addEventListener('click',()=>{ if(state.spinning) return; if(state.autoLeft>0){ state.autoLeft=0; if(state.autoTimer) clearTimeout(state.autoTimer); updateHUD(); setStatus('å·²åœæ­¢è‡ªåŠ¨ã€‚','warn'); } else { state.autoLeft=25; updateHUD(); doSpin(); }});
  balanceAdd.addEventListener('click',()=>{ state.balance+=100; updateHUD(); setStatus('å·²æ·»åŠ è¯•ç”¨é‡‘ 100ã€‚','ok'); });
  betMinus.addEventListener('click',()=>{ if(state.betPerLine>1){ state.betPerLine--; updateHUD(); }});
  betPlus.addEventListener('click',()=>{ state.betPerLine=Math.min(100,state.betPerLine+1); updateHUD(); });
  linesMinus.addEventListener('click',()=>{ state.lines=Math.max(1,state.lines-1); updateHUD(); });
  linesPlus.addEventListener('click',()=>{ state.lines=Math.min(state.maxLines,state.lines+1); updateHUD(); });
  settingsBtn.addEventListener('click',()=>{ modalMask.style.display='flex'; });
  closeModal.addEventListener('click',()=>{ modalMask.style.display='none'; });
  modalMask.addEventListener('click',e=>{ if(e.target===modalMask) modalMask.style.display='none';});
  maxLinesMinus.addEventListener('click',()=>{ state.maxLines=Math.max(1,state.maxLines-1); if(state.lines>state.maxLines) state.lines=state.maxLines; updateHUD(); });
  maxLinesPlus.addEventListener('click',()=>{ state.maxLines=Math.min(5,state.maxLines+1); updateHUD(); });

  // æ¨¡æ‹Ÿï¼šè¿”å¥–ç‡ + ä¸­å¥–ç‡
  runSim.addEventListener('click',()=>{
    const bet=Math.max(1,Math.min(100,Number(simBet.value)||1));
    const lines=Math.max(1,Math.min(5,Number(simLines.value)||1));
    const rounds=Math.max(1,Math.min(100000,Number(simRounds.value)||1));
    const effLines=Math.min(lines,state.maxLines);

    let totalStake=0,totalGain=0, winRounds=0; // ä¸­å¥–å±€æ•° winRounds
    for(let i=0;i<rounds;i++){
      const grid=spinOnce();
      totalStake += bet * effLines;
      const res=evaluate(grid, bet, effLines);
      totalGain += res.win;
      if(res.hit) winRounds++;
    }
    const rtp = totalGain/totalStake*100;
    const hitRate = winRounds/rounds*100;
    simResult.innerHTML = `è¿è¡Œï¼š${rounds.toLocaleString()} æ¬¡ï¼›æ¯çº¿ï¼š${bet}ï¼›çº¿æ•°ï¼š${effLines}<br/>æ€»ä¸‹æ³¨ï¼š${totalStake.toLocaleString()}ï¼›æ€»è·å¾—ï¼š${totalGain.toLocaleString()}<br/>è¿”å¥–ç‡ RTPï¼š<b>${rtp.toFixed(2)}%</b>ã€€ï½œã€€ä¸­å¥–ç‡ï¼š<b>${hitRate.toFixed(2)}%</b>`;
  });

  // åˆå§‹åŒ–ç½‘æ ¼
  const init=spinOnce(); renderGrid(init); updateHUD(); setStatus('è®¾ç½®ä¸‹æ³¨åç‚¹å‡» SPINã€‚');
})();
</script>
</body>
</html>
